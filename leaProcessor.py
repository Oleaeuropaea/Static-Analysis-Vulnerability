from opProcessor import OpProcessor
from utils import getRelativeOffset


class LeaProcessor(OpProcessor):
    def __init__(self, context):
        super().__init__('lea')
        self._ctx = context

    def process(self, instruction):
        super().process(instruction)
        # e.g lea    rax,[rbp-0x30]
       #TODO lea    rsi,[rip+0xa2]
        args = instruction['args']

        adressPlusOffset = args['value']
        offset=adressPlusOffset[adressPlusOffset.find("rbp")+1:adressPlusOffset.find("]")]
        offsetInvertedSignal = getRelativeOffset(offset)

        self._ctx.setRegisterValue(args['dest'], offsetInvertedSignal)

        return []






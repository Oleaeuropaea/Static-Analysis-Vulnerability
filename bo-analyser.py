#!/usr/bin/python3
import sys
import json
from processor import Processor

class ClassEncoder(json.JSONEncoder):
    def default(self, obj):
        return obj.__dict__

def main(argv):
    filename = argv[1]

    if not filename.endswith('.json'):
        print('python ./bo-analyser <program>.json')
        print('./bo-analyser <program>.json')
        sys.exit(2)

    with open(filename) as input:
        content = input.read()

    code = json.loads(content)

    proc = Processor(code)
    res = proc.run()
    
    filename = filename.replace('.json', '.output.json')

    stringRes = json.dumps(res, indent=4, cls=ClassEncoder)
    with open(filename, 'w') as output:
        output.write(stringRes)

    print('Finished!')

if __name__ == '__main__':
    main(sys.argv)